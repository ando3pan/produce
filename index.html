<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seasonal Produce Tier Carousel</title>
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body { padding: 2rem; font-family: sans-serif; background: #f8f9fa; }
    .carousel-item { padding: 1rem; }
    h2 { margin-bottom: 1rem; }
    .tier-section { margin-bottom: 1.5rem; }
    .tier-section h3 { margin-bottom: .5rem; }
    .tier-list { list-style: none; padding-left: 0; }
    .tier-list li { margin: .25rem 0; }
    .badge { margin-left: .5rem; }
    .controls { text-align: center; margin-top: 1rem; }
    .controls button { margin: 0 .5rem; }
  </style>
</head>
<body>

  <h1 class="mb-4 text-center">Seasonal Produce by Month</h1>

  <div id="produceCarousel" class="carousel slide">
    <div class="carousel-indicators" id="carousel-indicators"></div>
    <div class="carousel-inner" id="carousel-inner"></div>
  </div>

  <div class="controls">
    <button id="prevBtn" class="btn btn-outline-primary">← Previous</button>
    <button id="nextBtn" class="btn btn-outline-primary">Next →</button>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Static seasonality data & tier logic (same as before)...
    const seasons = { /* … your month→produce arrays … */ };
    const tierLabels = { S:"Top Picks", A:"Great Deals", B:"Okay", D:"Skip" };
    function computeTier(today,best){
      if(today==null||best==null) return "D";
      const r = today/best;
      if(r<=1.10) return "S";
      if(r<=1.30) return "A";
      if(r<=1.60) return "B";
      return "D";
    }

    async function init() {
      const res = await fetch("prices.json");
      const prices = await res.json();

      const indicators = document.getElementById("carousel-indicators");
      const inner = document.getElementById("carousel-inner");
      const months = Object.keys(seasons);

      months.forEach((month, idx) => {
        // indicator
        const dot = document.createElement("button");
        dot.type = "button";
        dot.dataset.bsTarget = "#produceCarousel";
        dot.dataset.bsSlideTo = idx;
        if(idx===0) dot.classList.add("active");
        dot.setAttribute("aria-label", month);
        indicators.appendChild(dot);

        // slide
        const slide = document.createElement("div");
        slide.className = "carousel-item" + (idx===0 ? " active" : "");

        // annotate & bucket
        const annotated = seasons[month].map(name => {
          const p = prices[name]||{};
          const today = p.today, best = p.best;
          return { name, today, best, tier: computeTier(today,best) };
        });
        const buckets = { S:[], A:[], B:[], D:[] };
        annotated.forEach(i=> buckets[i.tier].push(i));

        // render
        slide.innerHTML = `<h2>${month}</h2>` +
          ["S","A","B","D"].map(t=>`
            <div class="tier-section">
              <h3>${t} — ${tierLabels[t]}</h3>
              <ul class="tier-list">
                ${buckets[t].map(i=>`
                  <li>${i.name} — ${i.today!=null?`$${i.today.toFixed(2)}`:"—"}
                    <span class="badge bg-secondary">${i.tier}</span>
                  </li>`).join("")}
              </ul>
            </div>
          `).join("");
        inner.appendChild(slide);
      });

      // initialize carousel with wrap disabled and no auto-ride
      const carouselEl = document.getElementById("produceCarousel");
      const carousel = new bootstrap.Carousel(carouselEl, {
        interval: false,
        wrap: false
      });

      // wire up buttons
      document.getElementById("prevBtn").addEventListener("click", ()=> carousel.prev());
      document.getElementById("nextBtn").addEventListener("click", ()=> carousel.next());
    }

    init();
  </script>
</body>
</html>
