<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seasonal Produce Tier Carousel</title>
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    /* Add extra bottom padding so content isn’t hidden under the navbar */
    body {
      padding: 2rem 1rem 5rem;
      font-family: sans-serif;
      background: #f8f9fa;
    }
    .carousel-item {
      padding: 1rem;
    }
    h2 {
      margin-bottom: 1rem;
    }
    .tier-section {
      margin-bottom: 1.5rem;
    }
    .tier-section h3 {
      margin-bottom: .5rem;
    }
    .tier-list {
      list-style: none;
      padding-left: 0;
    }
    .tier-list li {
      margin: .25rem 0;
    }
    .badge {
      margin-left: .5rem;
    }
    /* Bottom navbar overrides */
    .navbar.fixed-bottom {
      box-shadow: 0 -1px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h1 class="mb-4 text-center">Seasonal Produce by Month</h1>

  <div id="produceCarousel" class="carousel slide">
    <div class="carousel-indicators" id="carousel-indicators"></div>
    <div class="carousel-inner" id="carousel-inner"></div>
  </div>

  <!-- Fixed-bottom navbar for controls -->
  <nav class="navbar fixed-bottom navbar-light bg-light border-top">
    <div class="container-fluid justify-content-between">
      <button id="prevBtn" class="btn btn-outline-primary">← Previous</button>
      <button id="nextBtn" class="btn btn-outline-primary">Next →</button>
    </div>
  </nav>

  <!-- Bootstrap JS Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 1) Static seasonality data
    const seasons = {
      "January":    ["Apples","Avocados","Bananas","Beets","Brussels Sprouts","Cabbage","Carrots","Celery","Collard Greens","Grapefruit","Kale","Kiwifruit","Leeks","Lemons","Limes","Onions","Parsnips","Pears","Potatoes","Turnips","Winter Squash"],
      "February":   ["Beets","Cabbage","Carrots","Collard Greens","Grapefruit","Kale","Kiwifruit","Leeks","Lemons","Limes","Onions","Parsnips","Pears","Potatoes","Spinach","Turnips","Winter Squash"],
      "March":      ["Apples","Cabbage","Carrots","Dried Beans","Herbs","Onions","Parsnips","Potatoes","Turnips","Winter Squash"],
      "April":      ["Apples","Carrots","Dried Beans","Herbs","Lettuce","Onions","Parsnips","Potatoes","Radishes"],
      "May":        ["Apples","Asparagus","Beet Greens","Dried Beans","Herbs","Lettuce","Onions","Potatoes","Radishes","Rhubarb","Spinach","Turnip Greens"],
      "June":       ["Apples","Asparagus","Beet Greens","Beets","Broccoli","Cabbage","Dried Beans","Garlic","Herbs","Lettuce","Mustard Greens","Onions","Peas","Potatoes","Radishes","Rhubarb","Spinach","Strawberries","Summer Squash","Swiss Chard"],
      "July":       ["Apples","Beet Greens","Beets","Blueberries","Broccoli","Cabbage","Carrots","Cherries","Collard Greens","Dried Beans","Garlic","Herbs","Lettuce","Mustard Greens","Onions","Peas","Peppers","Potatoes","Radishes","Raspberries","Rhubarb","Snap Beans","Spinach","Strawberries","Summer Squash","Swiss Chard","Tomatoes","Zucchini"],
      "August":     ["Apples","Beet Greens","Beets","Blackberries","Blueberries","Broccoli","Cabbage","Cantaloupe","Carrots","Cauliflower","Celery","Collard Greens","Corn","Cucumbers","Eggplant","Garlic","Grapes","Herbs","Leeks","Lettuce","Mustard Greens","Onions","Peaches","Pears","Peppers","Plums","Potatoes","Radishes","Snap Beans","Spinach","Summer Squash","Swiss Chard","Tomatoes","Zucchini"],
      "September":  ["Apples","Beet Greens","Beets","Blackberries","Blueberries","Broccoli","Brussels Sprouts","Cabbage","Cantaloupe","Carrots","Cauliflower","Celery","Collard Greens","Corn","Cucumbers","Eggplant","Garlic","Grapes","Herbs","Kale","Leeks","Lettuce","Mustard Greens","Onions","Peaches","Pears","Peppers","Plums","Potatoes","Pumpkin","Radishes","Raspberries","Snap Beans","Spinach","Summer Squash","Swiss Chard","Tomatoes","Zucchini"],
      "October":    ["Apples","Beets","Broccoli","Brussels Sprouts","Cabbage","Carrots","Cauliflower","Celery","Collard Greens","Corn","Cucumbers","Dried Beans","Eggplant","Garlic","Grapes","Herbs","Kale","Leeks","Lettuce","Mustard Greens","Onions","Parsnips","Pears","Peppers","Potatoes","Pumpkins","Radishes","Snap Beans","Spinach","Summer Squash","Swiss Chard","Tomatoes","Turnips","Zucchini"],
      "November":   ["Apples","Avocados","Bananas","Beets","Brussels Sprouts","Cabbage","Carrots","Celery","Collard Greens","Grapefruit","Kale","Kiwifruit","Leeks","Lemons","Limes","Onions","Parsnips","Pears","Potatoes","Spinach","Turnips","Winter Squash"],
      "December":   ["Apples","Avocados","Bananas","Beets","Brussels Sprouts","Cabbage","Carrots","Celery","Collard Greens","Grapefruit","Kale","Kiwifruit","Leeks","Lemons","Limes","Onions","Parsnips","Pears","Potatoes","Spinach","Turnips","Winter Squash"]
    };

    // 2) Tier labels & logic
    const tierLabels = { S: "Top Picks", A: "Great Deals", B: "Okay", D: "Skip" };
    function computeTier(today, best) {
      if (today == null || best == null) return "D";
      const ratio = today / best;
      if (ratio <= 1.10) return "S";
      if (ratio <= 1.30) return "A";
      if (ratio <= 1.60) return "B";
      return "D";
    }

    // 3) Build and initialize carousel
    async function init() {
      const resp = await fetch("prices.json");
      const prices = await resp.json();

      const indicators = document.getElementById("carousel-indicators");
      const inner = document.getElementById("carousel-inner");
      const months = Object.keys(seasons);

      months.forEach((month, idx) => {
        // Indicator
        const dot = document.createElement("button");
        dot.type = "button";
        dot.dataset.bsTarget = "#produceCarousel";
        dot.dataset.bsSlideTo = idx;
        if (idx === 0) dot.classList.add("active");
        dot.setAttribute("aria-label", month);
        indicators.appendChild(dot);

        // Slide
        const slide = document.createElement("div");
        slide.className = "carousel-item" + (idx === 0 ? " active" : "");

        // Annotate & bucket items
        const annotated = seasons[month].map(name => {
          const p = prices[name] || {};
          return {
            name,
            today: p.today,
            best: p.best,
            tier: computeTier(p.today, p.best)
          };
        });
        const buckets = { S: [], A: [], B: [], D: [] };
        annotated.forEach(item => buckets[item.tier].push(item));

        // Render tier sections
        slide.innerHTML = `<h2>${month}</h2>` +
          ["S","A","B","D"].map(t => `
            <div class="tier-section">
              <h3>${t} — ${tierLabels[t]}</h3>
              <ul class="tier-list">
                ${buckets[t].map(i => `
                  <li>${i.name} — ${i.today != null ? `$${i.today.toFixed(2)}` : "—"}
                    <span class="badge bg-secondary">${i.tier}</span>
                  </li>
                `).join("")}
              </ul>
            </div>
          `).join("");

        inner.appendChild(slide);
      });

      // Initialize manual carousel (no auto-wrap, no auto-slide)
      const carouselEl = document.getElementById("produceCarousel");
      const carousel = new bootstrap.Carousel(carouselEl, {
        interval: false,
        wrap: false
      });

      // Wire Prev/Next buttons
      document.getElementById("prevBtn").onclick = () => carousel.prev();
      document.getElementById("nextBtn").onclick = () => carousel.next();
    }

    init();
  </script>
</body>
</html>

